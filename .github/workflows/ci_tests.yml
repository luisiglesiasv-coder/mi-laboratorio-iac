# .github/workflows/ci_tests.yml

name: Ejecutar Pruebas de Infraestructura (CI)

on:
  push:
    branches: [ main ] # Ejecutar cuando se haga push a la rama 'main'

obs:
  test_infrastructure:
    runs-on: self-hosted 
    
    steps:
    - name: Checkout del Codigo
      uses: actions/checkout@v4 
      
    - name: Instalar paquetes esenciales de Python
      run: |
        # Garantizamos que venv y pip estÃ©n disponibles en el sistema
        sudo apt-get update
        sudo apt-get install -y python3-pip python3-venv 
        
    - name: ðŸš¨ Configurar y activar el entorno virtual ðŸš¨
      run: |
        # 1. Crear el entorno virtual llamado venv-ci
        python3 -m venv venv-ci
        
        # 2. Activar el entorno virtual para los siguientes comandos
        # NOTA: En GitHub Actions, la activaciÃ³n estÃ¡ndar 'source' a veces falla.
        # Es mÃ¡s fiable usar la ruta absoluta a los ejecutables.
        
        # 3. Actualizar Pip e instalar dependencias dentro del VENV
        ./venv-ci/bin/pip install --upgrade pip
        ./venv-ci/bin/pip install -r requirements.txt 

    - name: Ejecutar Pruebas de Infraestructura
      # Usar el ejecutable de pytest DENTRO del entorno virtual
      run: ./venv-ci/bin/pytest -v tests/features