---
# roles/vault_server/molecule/default/molecule.yml
dependency:
  name: galaxy
  enabled: false # avoid SSL error in Mac
driver:
  name: docker
platforms:
  - name: vault-unit-test
    image: geerlingguy/docker-ubuntu2204-ansible:latest
    privileged: true
    command: /sbin/init
    capabilities: [IPC_LOCK]
    volumes: ["/sys/fs/cgroup:/sys/fs/cgroup:rw"]
    cgroupns_mode: host
provisioner:
  name: ansible
  env:
    # Anchor Ansible to the project's roles directory
    ANSIBLE_ROLES_PATH: ../../../
    ANSIBLE_COLLECTIONS_PATH: ../../../../collections
  # --- SHARED LOGIC REDIRECTION ---
  playbooks:
    cleanup: ../_shared/cleanup.yml
  # --------------------------------
  config_options:
    defaults:
      host_key_checking: false
      interpreter_python: auto_silent
# Replace the default verifier with pytest for better BDD support
verifier:
  name: testinfra
  options:
    v: true
    tb: native